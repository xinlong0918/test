<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>pull-to-refresh</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="css/weui.min.css">
    <link rel="stylesheet" href="css/jquery-weui.min.css">
    <link rel="stylesheet" href="css/demos.css">
    <style type="text/css">


        .refresh {
            min-height: 100%;
        }
        .total{
            height:100px;
            background: #2baee9;
        }
        .top-nav{
            height:40px;
            background: #ff0;
            position: relative;
        }
        #choose {
            position: absolute;
            right: 10px;
            top: 8px;
            width: 100px;
            height: 24px;
            border: 1px solid #ccc;
            border-radius: 5px;
            line-height: 20px;
            text-align: center;
            font-size: 20px;
            background: #fff;
        }

    </style>
</head>
<body ontouchstart>

<div class="refresh">
    <div class="weui-pull-to-refresh__layer">
        <div class='weui-pull-to-refresh__arrow'></div>
        <div class='weui-pull-to-refresh__preloader'></div>
        <div class="down">下拉刷新</div>
        <div class="up">释放刷新</div>
        <div class="refresh">正在刷新</div>
    </div>
    <div class="total">
        可提取总金额：120
    </div>
    <div class="top-nav">
        七月总收入：30, 总支出：20
        <div id="choose">选择年月</div>
    </div>
    <div id="data-list">
        <div class="data-mouth">
            <div class="data-title">
                七月总收入：123 总支出：100
            </div>
            <ul>
                <li>
                    收入：+12
                </li>
                <li>
                    支出：-10
                </li>
                <li>
                    提现：-100
                </li>
                <li>
                    收入：+12
                </li>
                <li>
                    支出：-10
                </li>
                <li>
                    提现：-100
                </li>
                <li>
                    收入：+12
                </li>
                <li>
                    支出：-10
                </li>
                <li>
                    提现：-100
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="weui-loadmore">
    <i class="weui-loading"></i>
    <span class="weui-loadmore__tips">正在加载</span>
</div>
<script src="js/jquery-2.1.4.js"></script>
<script src="js/fastclick.js"></script>
<script>
    $(function () {
        FastClick.attach(document.body);
    });
</script>
<script src="js/jquery-weui.js"></script>
<script>
    $('.refresh').pullToRefresh().on('pull-to-refresh', function (done) {
        var self = this
        setTimeout(function () {
            $('#data-list').prepend("<p>《世界著名计算机教材精选·人工智能:一种现代的方法(第3版)》英文版有1100多页，教学内容非常丰富，不但涵盖了人工智能基础、问题求解、知识推理与规划等经典内容，而且还包括不确定知识与推理、机器学习、通讯感知与行动等专门知识的介绍。目前我们为本科生开设的学科基础必修课“人工智能导论”主要介绍其中的经典内容，而研究生必修的核心课程“人工智能原理”主要关注其中的专门知识。其实《世界著名计算机教材精选·人工智能:一种现代的方法(第3版)》也适合希望提高自身计算系统设计水平的广大应用计算技术的社会公众，对参加信息学奥林匹克竞赛和ACM程序设计竞赛的选手及其教练员也有一定的参考作用。</p>");
            $(self).pullToRefreshDone();
            $()
        }, 1000)
    })
    var loading = false;
    $(document.body).infinite().on("infinite", function () {
        if (loading) return;
        loading = true;
        setTimeout(function () {
            $('#data-list').append("<p>《世界著名计算机教材精选·人工智能:一种现代的方法(第3版)》英文版有1100多页，教学内容非常丰富，不但涵盖了人工智能基础、问题求解、知识推理与规划等经典内容，而且还包括不确定知识与推理、机器学习、通讯感知与行动等专门知识的介绍。目前我们为本科生开设的学科基础必修课“人工智能导论”主要介绍其中的经典内容，而研究生必修的核心课程“人工智能原理”主要关注其中的专门知识。其实《世界著名计算机教材精选·人工智能:一种现代的方法(第3版)》也适合希望提高自身计算系统设计水平的广大应用计算技术的社会公众，对参加信息学奥林匹克竞赛和ACM程序设计竞赛的选手及其教练员也有一定的参考作用。</p>");
            loading = false;
        }, 1000);
    });
    $(document.body).scrollTop(0)
</script>
<script src="js/picker.min.js"></script>
<script type="text/javascript">
    let data = [
        {
            "name": 2011,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
                , {"name": 8}
                , {"name": 9}
                , {"name": 10}
                , {"name": 11}
                , {"name": 12}
            ]
        },
        {
            "name": 2012,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
                , {"name": 8}
                , {"name": 9}
                , {"name": 10}
                , {"name": 11}
                , {"name": 12}
            ]
        },
        {
            "name": 2013,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
                , {"name": 8}
                , {"name": 9}
                , {"name": 10}
                , {"name": 11}
                , {"name": 12}
            ]
        },
        {
            "name": 2014,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
                , {"name": 8}
                , {"name": 9}
                , {"name": 10}
                , {"name": 11}
                , {"name": 12}
            ]
        },
        {
            "name": 2015,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
                , {"name": 8}
                , {"name": 9}
                , {"name": 10}
                , {"name": 11}
                , {"name": 12}
            ]
        },
        {
            "name": 2016,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
                , {"name": 8}
                , {"name": 9}
                , {"name": 10}
                , {"name": 11}
                , {"name": 12}
            ]
        },
        {
            "name": 2017,
            "sub": [
                {"name": 1}
                , {"name": 2}
                , {"name": 3}
                , {"name": 4}
                , {"name": 5}
                , {"name": 6}
                , {"name": 7}
            ]
        }
    ]
    var nameEl = document.getElementById('choose');
    var first = [];
    /*年 */
    var second = [];
    /* 月 */
    var selectedIndex = [0, 0];
    /* 默认选中的年月 */

    var checked = [0, 0];
    /* 已选选项 */
    creatList(data, first);

    if (data[selectedIndex[0]].hasOwnProperty('sub')) {
        creatList(data[selectedIndex[0]].sub, second);
    } else {
        second = [{text: '', value: 0}];
    }
    var picker = new Picker({
        data: [first, second],
        selectedIndex: selectedIndex,
        title: '选择年月'
    });

    picker.on('picker.select', function (selectedVal, selectedIndex) {
        var text1 = first[selectedIndex[0]].text;
        var text2 = second[selectedIndex[1]].text;
        nameEl.innerText = text1 + ' ' + text2;
    });

    picker.on('picker.change', function (index, selectedIndex) {
        if (index === 0) {
            firstChange();
        }

        function firstChange() {
            second = [];
            checked[0] = selectedIndex;
            var firstData = data[selectedIndex];
            if (firstData.hasOwnProperty('sub')) {
                creatList(firstData.sub, second);
            } else {
                second = [{text: '', value: 0}];
                checked[1] = 0;
            }

            picker.refillColumn(1, second);
            picker.scrollColumn(1, 0)
        }
    });
    picker.on('picker.valuechange', function (selectedVal, selectedIndex) {
        console.log(selectedVal);
        console.log(selectedIndex);
    });

    nameEl.addEventListener('click', function () {
        picker.show();
    });
    function creatList(obj, list) {
        obj.forEach(function (item, index, arr) {
            var temp = new Object();
            temp.text = item.name;
            temp.value = index;
            list.push(temp);
        })
    }
</script>
</body>
</html>